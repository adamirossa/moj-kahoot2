<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Kahoot - Host</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }

        .quiz-builder {
            display: none;
        }

        .quiz-builder.active {
            display: block;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
        }

        input:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }

        .answer-input {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .answer-input input {
            flex: 1;
            margin-bottom: 0;
        }

        .answer-input input[type="radio"] {
            width: auto;
            margin: 0;
        }

        .game-screen {
            display: none;
            text-align: center;
        }

        .game-screen.active {
            display: block;
        }

        .game-pin {
            font-size: 4rem;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: 5px;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .question-display {
            font-size: 2rem;
            margin-bottom: 30px;
            text-align: center;
        }

        .answers-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .answer-display {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            font-size: 1.2rem;
            text-align: center;
            border: 3px solid transparent;
        }

        .answer-display.correct {
            border-color: #2ecc71;
            background: rgba(46, 204, 113, 0.3);
        }

        .timer {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
            color: #f39c12;
        }

        .timer.warning {
            color: #e74c3c;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .leaderboard {
            text-align: left;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .position {
            font-size: 1.5rem;
            font-weight: bold;
            margin-right: 15px;
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .error {
            background: rgba(231, 76, 60, 0.8);
        }

        .success {
            background: rgba(46, 204, 113, 0.8);
        }

        @media (max-width: 768px) {
            .game-pin {
                font-size: 2.5rem;
            }
            
            .answers-display {
                grid-template-columns: 1fr;
            }
            
            .question-display {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Kahoot Host</h1>
        </div>

        <div id="message" class="message"></div>

        <!-- Quiz Builder -->
        <div id="quizBuilder" class="quiz-builder active">
            <div class="card">
                <h2>Vytvor kv√≠z</h2>
                
                <input type="text" id="quizTitle" placeholder="N√°zov kv√≠zu" required>
                
                <div id="questionsContainer">
                    <!-- Questions will be added here -->
                </div>
                
                <button onclick="addQuestion()" class="btn-success">+ Prida≈• ot√°zku</button>
                <button onclick="createGame()" class="btn-primary">üöÄ Vytvori≈• hru</button>
            </div>
        </div>

        <!-- Game Lobby -->
        <div id="gameLobby" class="game-screen">
            <div class="card">
                <h2>ƒåak√°me na hr√°ƒçov...</h2>
                <div class="game-pin" id="gamePin">123456</div>
                <p>Hr√°ƒçi m√¥≈æu vst√∫pi≈• na: <strong id="joinUrl">localhost:3000</strong></p>
                
                <div id="playersContainer" class="players-grid">
                    <!-- Players will appear here -->
                </div>
                
                <button onclick="startGame()" id="startBtn" class="btn-success" disabled>
                    ‚ñ∂Ô∏è Spusti≈• hru
                </button>
            </div>
        </div>

        <!-- Question Display -->
        <div id="questionScreen" class="game-screen">
            <div class="card">
                <div id="questionNumber" style="font-size: 1.2rem; margin-bottom: 10px;"></div>
                <div id="questionText" class="question-display"></div>
                <div id="timer" class="timer">20</div>
                <div id="answersContainer" class="answers-display">
                    <!-- Answers will appear here -->
                </div>
                <button onclick="showResults()" class="btn-secondary">üìä Zobrazi≈• v√Ωsledky</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="game-screen">
            <div class="card">
                <h2>üìä V√Ωsledky ot√°zky</h2>
                <div id="correctAnswerDisplay" style="font-size: 1.5rem; margin: 20px 0;"></div>
                <div id="answerStatsContainer"></div>
                <div id="leaderboardContainer" class="leaderboard"></div>
                <button onclick="nextQuestion()" id="nextBtn" class="btn-success">‚û°Ô∏è ƒéal≈°ia ot√°zka</button>
                <button onclick="endGame()" class="btn-danger">üèÅ Ukonƒçi≈• hru</button>
            </div>
        </div>

        <!-- Final Results -->
        <div id="finalScreen" class="game-screen">
            <div class="card">
                <h2>üèÜ Fin√°lne v√Ωsledky</h2>
                <div id="finalLeaderboard" class="leaderboard"></div>
                <button onclick="newGame()" class="btn-success">üéÆ Nov√° hra</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        let currentQuiz = null;
        let currentPin = null;
        let currentQuestionIndex = 0;
        let questionTimer = null;
        let players = [];

        // Sample quiz for testing
        const sampleQuiz = {
            title: "Testovac√≠ kv√≠z",
            questions: [
                {
                    question: "Ak√° je hlavn√° farba slnka?",
                    answers: ["Modr√°", "≈Ωlt√°", "ƒåerven√°", "Zelen√°"],
                    correctAnswer: 1,
                    timeLimit: 20
                },
                {
                    question: "Koƒæko n√¥h m√° pav√∫k?",
                    answers: ["6", "8", "10", "12"],
                    correctAnswer: 1,
                    timeLimit: 15
                }
            ]
        };

        function showMessage(text, type = 'error') {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 5000);
        }

        function addQuestion() {
            const container = document.getElementById('questionsContainer');
            const questionIndex = container.children.length;
            
            const questionCard = document.createElement('div');
            questionCard.className = 'question-card';
            questionCard.innerHTML = `
                <h3>Ot√°zka ${questionIndex + 1}</h3>
                <input type="text" placeholder="Text ot√°zky" class="question-text" required>
                <div class="answers-container">
                    ${[0,1,2,3].map(i => `
                        <div class="answer-input">
                            <input type="text" placeholder="Odpoveƒè ${i + 1}" class="answer-text">
                            <input type="radio" name="correct-${questionIndex}" value="${i}" ${i === 0 ? 'checked' : ''}>
                            <label>Spr√°vna</label>
                        </div>
                    `).join('')}
                </div>
                <input type="number" placeholder="ƒåas (sekundy)" value="20" min="5" max="60" class="time-limit">
                <button onclick="removeQuestion(this)" class="btn-danger">üóëÔ∏è Odstr√°ni≈•</button>
            `;
            
            container.appendChild(questionCard);
        }

        function removeQuestion(btn) {
            btn.parentElement.remove();
            updateQuestionNumbers();
        }

        function updateQuestionNumbers() {
            const questions = document.querySelectorAll('.question-card h3');
            questions.forEach((h3, index) => {
                h3.textContent = `Ot√°zka ${index + 1}`;
            });
        }

        function createGame() {
            const title = document.getElementById('quizTitle').value.trim();
            const questionCards = document.querySelectorAll('.question-card');
            
            if (!title) {
                showMessage('Zadaj n√°zov kv√≠zu!');
                return;
            }
            
            if (questionCards.length === 0) {
                showMessage('Pridaj aspo≈à jednu ot√°zku!');
                return;
            }
            
            const questions = [];
            
            for (let card of questionCards) {
                const questionText = card.querySelector('.question-text').value.trim();
                const answerInputs = card.querySelectorAll('.answer-text');
                const correctRadio = card.querySelector('input[type="radio"]:checked');
                const timeLimit = parseInt(card.querySelector('.time-limit').value) || 20;
                
                if (!questionText) {
                    showMessage('Vypl≈à v≈°etky ot√°zky!');
                    return;
                }
                
                const answers = [];
                let filledAnswers = 0;
                
                answerInputs.forEach(input => {
                    const text = input.value.trim();
                    if (text) {
                        answers.push(text);
                        filledAnswers++;
                    }
                });
                
                if (filledAnswers < 2) {
                    showMessage('Ka≈æd√° ot√°zka mus√≠ ma≈• aspo≈à 2 odpovede!');
                    return;
                }
                
                // Fill remaining answers with empty strings
                while (answers.length < 4) {
                    answers.push('');
                }
                
                questions.push({
                    question: questionText,
                    answers,
                    correctAnswer: parseInt(correctRadio.value),
                    timeLimit
                });
            }
            
            currentQuiz = { title, questions };
            
            // Create game on server
            fetch('/api/create-game', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ quiz: currentQuiz })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    currentPin = data.pin;
                    showGameLobby(data.pin);
                    socket.emit('host-join', data.pin);
                } else {
                    showMessage('Chyba pri vytv√°ran√≠ hry!');
                }
            })
            .catch(err => {
                showMessage('Chyba pripojenia!');
            });
        }

        function showGameLobby(pin) {
            document.getElementById('quizBuilder').classList.remove('active');
            document.getElementById('gameLobby').classList.add('active');
            document.getElementById('gamePin').textContent = pin;
            document.getElementById('joinUrl').textContent = window.location.origin + '?pin=' + pin;
        }

        function startGame() {
            if (players.length === 0) {
                showMessage('ƒåakaj na hr√°ƒçov!');
                return;
            }
            
            socket.emit('start-game', currentPin);
        }

        function showQuestion(data) {
            document.getElementById('gameLobby').classList.remove('active');
            document.getElementById('questionScreen').classList.add('active');
            
            document.getElementById('questionNumber').textContent = 
                `Ot√°zka ${data.questionNumber} z ${data.totalQuestions}`;
            document.getElementById('questionText').textContent = data.question;
            
            const answersContainer = document.getElementById('answersContainer');
            answersContainer.innerHTML = data.answers.map((answer, index) => `
                <div class="answer-display" style="background: ${['#e74c3c', '#3498db', '#f39c12', '#2ecc71'][index]};">
                    ${answer.text || `Odpoveƒè ${index + 1}`}
                </div>
            `).join('');
            
            startTimer(data.timeLimit);
        }

        function startTimer(duration) {
            let timeLeft = duration;
            const timerEl = document.getElementById('timer');
            
            questionTimer = setInterval(() => {
                timerEl.textContent = timeLeft;
                
                if (timeLeft <= 5) {
                    timerEl.classList.add('warning');
                } else {
                    timerEl.classList.remove('warning');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(questionTimer);
                    showResults();
                }
                
                timeLeft--;
            }, 1000);
        }

        function showResults() {
            if (questionTimer) {
                clearInterval(questionTimer);
            }
            
            socket.emit('show-results', currentPin);
        }

        function displayResults(data) {
            document.getElementById('questionScreen').classList.remove('active');
            document.getElementById('resultsScreen').classList.add('active');
            
            // Show correct answer
            const correctAnswerEl = document.getElementById('correctAnswerDisplay');
            correctAnswerEl.innerHTML = `
                <strong>Spr√°vna odpoveƒè:</strong> 
                <span style="color: #2ecc71;">${data.answerStats[data.correctAnswer].text}</span>
            `;
            
            // Show answer statistics
            const statsContainer = document.getElementById('answerStatsContainer');
            statsContainer.innerHTML = data.answerStats.map((stat, index) => `
                <div style="margin: 10px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>${stat.text || `Odpoveƒè ${index + 1}`}</span>
                        <span><strong>${stat.count} (${stat.percentage}%)</strong></span>
                    </div>
                    <div style="width: 100%; height: 10px; background: rgba(255,255,255,0.2); border-radius: 5px;">
                        <div style="width: ${stat.percentage}%; height: 100%; background: ${stat.isCorrect ? '#2ecc71' : '#e74c3c'}; border-radius: 5px;"></div>
                    </div>
                </div>
            `).join('');
            
            // Show leaderboard
            updateLeaderboard(data.leaderboard);
            
            // Update next button
            const nextBtn = document.getElementById('nextBtn');
            if (currentQuestionIndex + 1 >= currentQuiz.questions.length) {
                nextBtn.textContent = 'üèÅ Ukonƒçi≈• hru';
                nextBtn.onclick = endGame;
            }
        }

        function updateLeaderboard(leaderboard) {
            const container = document.getElementById('leaderboardContainer');
            container.innerHTML = '<h3>üèÜ Top 5 hr√°ƒçov</h3>' + 
                leaderboard.map((player, index) => {
                    const medals = ['ü•á', 'ü•à', 'ü•â'];
                    const medal = medals[index] || `${index + 1}.`;
                    
                    return `
                        <div class="leaderboard-item">
                            <div>
                                <span class="position">${medal}</span>
                                <span>${player.name}</span>
                            </div>
                            <span><strong>${player.score}</strong></span>
                        </div>
                    `;
                }).join('');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            socket.emit('next-question', currentPin);
        }

        function endGame() {
            socket.emit('next-question', currentPin); // This will trigger game end if no more questions
        }

        function showFinalResults(results) {
            document.getElementById('resultsScreen').classList.remove('active');
            document.getElementById('finalScreen').classList.add('active');
            
            const container = document.getElementById('finalLeaderboard');
            container.innerHTML = results.map((player, index) => {
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                const medal = medals[index] || `${index + 1}.`;
                
                return `
                    <div class="leaderboard-item">
                        <div>
                            <span class="position">${medal}</span>
                            <span>${player.name}</span>
                        </div>
                        <span><strong>${player.score}</strong></span>
                    </div>
                `;
            }).join('');
        }

        function newGame() {
            location.reload();
        }

        // Socket events
        socket.on('host-joined', (data) => {
            if (!data.success) {
                showMessage('Chyba pri pripojen√≠!');
            }
        });

        socket.on('players-update', (playersList) => {
            players = playersList;
            const container = document.getElementById('playersContainer');
            
            container.innerHTML = players.map(player => `
                <div class="player-card">
                    <strong>${player.name}</strong>
                </div>
            `).join('');
            
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = players.length === 0;
            startBtn.textContent = `‚ñ∂Ô∏è Spusti≈• hru (${players.length} hr√°ƒçov)`;
        });

        socket.on('question-start', (data) => {
            showQuestion(data);
        });

        socket.on('results-show', (data) => {
            displayResults(data);
        });

        socket.on('game-finished', (results) => {
            showFinalResults(results);
        });

        // Initialize with sample question
        addQuestion();
    </script>
</body>
</html>